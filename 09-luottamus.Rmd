\lefthyphenmin=62
\righthyphenmin=62
# Otosjakaumat ja epävarmuuden arvioiminen {#luku9}

Tässä luvussa pohditaan tarkemmin sitä, miten tilastollisessa tutkimuksessa saatujen tulosten epävarmuutta voidaan arvioida. Erilaisten tutkimustulosten yhteydessä törmätään usein niin kutsutun virhemarginaalin käsitteeseen. Virhemarginaalilla tarkoitetaan kansankielessä jonkin tunnusluvun, kuten esimerkiksi keskiarvon, arvojen sellaista vaihteluväliä, joka johtuu satunnaisuudesta. Käytännössä se tarkoittaa sitä, että saatu tulos, estimaatti, on jollain tavalla epävarma. Mistä tämä epävarmuus tutkimustuloksissa kumpuaa ja miten siihen voidaan tutkimusta tai koetta suunnitellessa vaikuttaa? Tilastotieteen yksi keskeisiä tavoitteita on pyrkiä saamaan tarkkaa ja tutkittua tietoa. Kun tutkimuskohteena on epävarma ja satunnainen ympäröivä maailma, onkin tilastollisten menetelmien luotettavuuden kannalta keskeistä pyrkiä arvioimaan tätä epävarmuutta, jotta saatuihin tuloksiin voidaan luottaa.

## Otosjakauma: estimaattorit ja estimaatit {#alaluku91}

::: {.defblock .mikko data-latex="{}"}
**Tunnusluvun/estimaattorin otosjakauma**  

Tunnusluku $T$ on satunnaismuuttujien $Y_1,\dots,Y_n$ funktiona myös satunnaismuuttuja. Tämä tarkoittaa että tunnusluvun $T$ arvot vaihtelevat otoksesta toiseen jonkin todennäköisyysjakauman mukaisesti. Tätä kutsutaan _tunnusluvun_ $T$ __otosjakaumaksi__, joka muodostaa __tilastollisen mallin__ tunnusluvun $T$ arvojen satunnaiselle vaihtelulle otoksesta toiseen. 
:::

- Otosjakaumat riippuvat tuntemattomista __parametreista__, joiden arvoja ei yleensä tunneta ja niitä pyritään estimoimaan kerättyä otosta ja sopivaa tunnuslukua käyttäen.
  - Parametri on (usein) perusjoukon tunnusluku, jota halutaan arvioida. Parametrit __estimoidaan__, kuten yllä jo todettiin, havaintoaineistoa käyttäen.
  - Otosjakaumien teoria muodostaa perustan parametrien estimoinnille sekä estimaattorien ominaisuuksille sekä parametreja koskevien hypoteesien testaamiselle.
  
- Tilastollinen päättely tähän asti opittuna:
  - Tilastollisessa tutkimuksessa pyritään tekemään päätelmiä aineiston generoineen satunnaisilmiön luonteesta, ts. tehdä yleistyksiä otoksesta perusjoukkoon.
  - Satunnaisilmiötä ja sen generoinutta aineistoa kuvataan todennäköisyysjakaumalla, jonka muodon määrää kyseisen jakauman parametrit.
  - Parametrit ovat tilastollisessa päättelyssä mielenkiinnon kohteena ja niitä pyritään estimoimaan havaintoaineistosta otostunnusluvuilla/estimaattoreilla.
  - Satunnaismuuttujien funktioina myös otostunnusluvut/estimaattorit ovat satunnaismuuttujia, jolloin niilläkin on todennäköisyysjakaumat.
  - Tunnuslukujen todennäköisyysjakaumaa kutsutaan otosjakaumaksi.
  - Otosjakauman avulla saatujen tunnuslukujen/estimaattien luotettavuutta voidaan arvioida!
  
  
__Aritmeettisen keskiarvon ominaisuuksia__

- Edellisestä luvusta \@ref(luku8) muistamme, että aritmeettinen keskiarvo on eräs aineistosta yleisesti laskettu tunnusluku.
  - Tarkastellaan seuraavaksi aritmeettisen keskiarvon otosjakauman ominaisuuksia.
  - Aiempien oletusten pätiessä voidaan osoittaa että aritmeettisella keskiarvolla $\bar{Y}$ on seuraava odotusarvo ja varianssi:
$$
\text{E}(\bar{Y}) = \mu,  \quad
\mathrm{Var}(\bar{Y}) = \frac{\sigma^2}{n}.
$$

- Aritmeettisen keskiarvon $\bar{Y}$ __standardipoikkeama__ on tällöin

$$
\text{D}(\bar{Y}) = \sqrt{\mathrm{Var}(\bar{Y})} = \frac{\sigma}{\sqrt{n}}.
$$

- Standardipoikkeamaa kutsutaan myös __keskiarvon keskivirheeksi__ ja se kuvaa otoskeskiarvon otosvaihtelua odotusarvon $\mu$ ympärillä.
  - Huomioi, että __otoskeskiarvon varianssi__ on eri asia kuin __otosvarianssi__.
  - Otoskeskiarvon varianssi kuvaa sitä, miten otoskeskiarvon toteumat vaihtelevat otantaa toistettaessa, eli otoksesta toiseen.
  - Näin ollen otoskeskiarvon varianssia voidaan käyttää saadun otoskeskiarvon toteuman luotettavuuden arviointiin!

- Huomataan, että aritmeettisen keskiarvon otosjakauma keskittyy yhä voimakkaammin havaintojen yhteisen odotusarvon $\mu$ ympärille, kun otoskoko $n$ kasvaa. 
  - Ts. otoskoon $n$ kasvaessa $\mathrm{Var}(\bar{Y}) = \frac{\sigma^2}{n}$ pienenee.
  - Näin ollen aritmeettinen keskiarvo tuottaa tarkempia estimaatteja odotusarvosta silloin, kun otoskoko on suuri!

__Normaalijakautunut otos__

- Muodostakoot havainnot $Y_1, \ldots, Y_n$ satunnaisotoksen normaalijakaumasta $\text{N}(\mu, \sigma^2)$.
- Tällöin voidaan osoittaa, että havaintojen $Y_1, \ldots, Y_n$ keskiarvo $\bar{Y}$ noudattaa normaalijakaumaa odotusarvolla $\mu$ ja varianssilla $\sigma^2/n$. Merkitään
$$
\bar{Y} \thicksim \text{N} \Big(\mu, \frac{\sigma^2}{n} \Big).
$$

- Itse asiassa ns. __asymptoottiseen teoriaan__ vedoten (suurten otosten tapauksessa) voidaan osoittaa, että edellämainittu tulos pätee myös ilman normaalisuusoletusta. 
  - Nämä tarkastelut vaativat jälleen selvästi enemmän käytyjä tilastotieteen (ja matematiikan) opintoja.

::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: aritmeettisen keskiarvon otosjakauma normaalijakautuneen aineiston tapauksessa** 

Tarkastellaan seuraavaksi simuloidun esimerkin avulla aritmeettisen keskiarvon ominaisuuksia. Erityisesti klassisessa tilastotieteessä tilastollinen päättely, esimerkiksi luottamusvälien konstrulointi, perustuu ajatukselle toistetusta aineistonkeruusta. Tätä on helppoa havainnollistaa käyttäen moderneja tietoteknisiä ratkaisuja, joiden avulla voidaan generoida halutulla tavalla jakautuneiden satunnaismuuttujien realisaatioita. Aritmeettisen otoskeskiarvon tapauksessa tämä tarkoittaa sitä, miten realisoituneet otoskeskiarvot vaihtelevat satunnaisesti, kun otantaa samasta kohdepopulaatiosta toistetaan. Yllä esitetyn tuloksen nojalla otoskoko näyttelee keskeistä roolia otoskeskiarvojen vaihtelun suhteen. 

Olkoon $Y_1^{(j)},\dots,Y_n^{(j)}$ $j$:s otos suuresta (äärettömästä) populaatiosta, jossa $j=1,\dots,J$ indeksoi eri otoksia. Oletetaan lisäksi, että $Y_i^{(j)} \sim N(60,25)$ kaikille $j=1,\dots,J$ ja $i=1,\dots,n$ ja että tilastoyksiköt ovat keskenään riippumattomia kaikissa otoksissa. Toisin sanoen, kerätään $J$ otosta kohdepopulaatiosta, joista jokaisessa tilastoyksiköt ovat samoin ja riippumattomasti jakautuneita.

Tiedetään, että normaalisti jakautuneen populaation tapauksessa otoskeskiarvo on odotusarvon harhaton estimaattori, ts. että $E(\bar{Y}) = \mu$ ja että sen otosjakauma on muotoa $\bar{Y} \sim \text{N}(\mu,\frac{\sigma^2}{n})$. Täten __otoskoolla__ on suuri merkitys sille kuinka keskittynyt aritmeettisen keskiarvon otosjakauma on. Suurella otoskoolla tulisi teoriassa siis saada parempia arvioita aineiston generoineen jakauman odotusarvosta!

Alla Kuviossa \@ref(fig:otosjakaumat1) havainnollistetaan yllä kuvatun _toistetun aineistonkeruun_ ajatusta aritmeettisen keskiarvon otosjakauman taustalla. Jakaumasta $N(60,25)$ generoitiin $J=50$ otosta, joista jokaisen otoskoko on $n=30$. Paneelissa A on havainnollistuksen vuoksi esitetty ensimmäisen kahdeksan otoksen histogrammit sekä näiden aritmeettiset keskiarvot (punaiset pisteet). Paneelissa B on kuvattu kaikkien $J=50$ otoksen keskiarvojen histogrammi. Lisäksi on laskettu __otoskeskiarvojen otoskeskiarvo__, jonka pitäisi harhattomuuden vuoksi olla lähellä populaatiotason odotusarvoa $\mu = 60$. Lisäksi on laskettu __otoskeskiarvojen varianssi__, jonka pitäisi saada arvo $\frac{\sigma^2}{n} = \frac{25}{30} \approx 0.83$. Estimaatteja ja teoreettisia normaalijakauman parametreja vastaavat tiheysfunktiot on piirretty kuvaan.
:::
\FloatBarrier
```{r otosjakaumat1, echo=FALSE, fig.cap="Toistetun aineistonkeruun ajatus otosjakaumien taustalla. Vasemmalla on esitetty kahdeksan ensimmäisen otoksen histogrammit samasta jakaumasta, kun otoskoko on 30. Oikealla on yhteensä 50 otoksesta laskettujen otoskeskiarvojen jakauma.", fig.align='center', out.width="100%", warning=FALSE}
library(ggplot2)
library(ggridges)
set.seed(88)
n = 30
s = 50
ridgelines1 = data.frame("values" = rnorm(n*s, 60, 5), "sample" = rep(c(1:s), each = n)) %>% group_by(sample) %>% mutate(mean = mean(values))
ridgelines_plot1 = ridgelines1 %>% filter(sample %in% c(1:8))
singlesamples1 = ggplot(ridgelines_plot1, aes(x = values, y = sample, group = sample, fill = sample)) + 
  stat_binline(bins = 15, scale = 1) +
  stat_summary(aes(group = sample), fun = mean, geom = "point", orientation = "y", color = "red") + ylab("") + xlab("Otosten histogrammit") + theme(legend.position = "none", axis.text.y = element_blank(), text = element_text(size = 8))
  
means1 = data.frame("means" = unique(ridgelines1$mean))

meanplot1 = ggplot(means1, aes(x = means)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(58, 62, by = 0.25), 
                   colour = "black", 
                   fill = "grey") +
  xlim(55,65) +
  stat_function(fun = dnorm, args = list(mean = mean(means1$means), sd = sd(means1$means)), 
                aes(colour = "line1")) +
  stat_function(fun = dnorm, args = list(mean = 60, sd = sqrt(0.8333333)), 
                aes(colour = "line2")) +
 theme_bw() + labs(x = "Otoskeskiarvot", y = "", color = "Tiheysfunktio") + 
  scale_colour_manual(values = c("line1" = "red", "line2" = "blue"), 
                      labels = c("Estimaatit: N(59.9, 0.6)", "Teoreettinen: N(60, 0.8)")) + theme(legend.position="bottom", axis.text.y = element_blank(), text = element_text(size = 8))
ggpubr::ggarrange(singlesamples1, meanplot1, ncol = 2, nrow = 1, labels = c("Paneeli A", "Paneeli B"))
```

::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: aritmeettisen keskiarvon otosjakauma normaalijakautuneen aineiston tapauksessa (jatkuu)** 

Mitä tapahtuu kun yksittäisen otoksen otoskokoa $n$ kasvatetaan? Teorian perusteella otoskeskiarvojen otosjakauman varianssi pitäisi pienentyä! Kuviossa \@ref(fig:otosjakaumat2) havainnollistetaan tätä. Jälleen generoitiin $J=50$ otosta populaatiojakaumasta $N(60,25)$, mutta tällä kertaa otoskokoa kasvatettiin tasolle $n=100$. Paneelissa A on jälleen havainnollistuksen vuoksi esitetty ensimmäisen kahdeksan otoksen histogrammit sekä näiden aritmeettiset keskiarvot (punaiset pisteet). Paneelissa B on kuvattu kaikkien $J=50$ otoksen keskiarvojen histogrammi sekä otoskeskiarvojen teoreettista otosjakaumaa ja vastaavaa estimoitua otosjakaumaa vastaavat tiheysfunktiot. Edelleen otoskeskiarvojen pitäisi harhattomuuden vuoksi olla lähellä arvoa $\mu = 60$, mutta tällä kertaa niiden varianssin pitäisi olla pienempi. Teoreettisesti otoskeskiarvojen varianssin pitäisi olla $\frac{\sigma^2}{n} = \frac{25}{100} = 0.25$. Havaitaan, että myös estimoitu otoskeskiarvojen varianssi on pienempi kuin edellisessä $n=30$ esimerkissä!
:::

```{r otosjakaumat2, echo=FALSE, fig.cap="Toistetun aineistonkeruun ajatus otosjakaumien taustalla. Vasemmalla on esitetty kahdeksan ensimmäisen otoksen histogrammit samasta jakaumasta, kun otoskoko on 100. Oikealla on yhteensä 50 otoksesta laskettujen otoskeskiarvojen jakauma.", fig.align='center', out.width="100%", warning=FALSE}
library(ggplot2)
library(ggridges)
set.seed(88)
n = 100
s = 50
ridgelines2 = data.frame("values" = rnorm(n*s, 60, 5), "sample" = rep(c(1:s), each = n)) %>% group_by(sample) %>% mutate(mean = mean(values))
ridgelines_plot2 = ridgelines2 %>% filter(sample %in% c(1:8))
singlesamples2 = ggplot(ridgelines_plot2, aes(x = values, y = sample, group = sample, fill = sample)) + 
  stat_binline(bins = 15, scale = 1) +
  stat_summary(aes(group = sample), fun = mean, geom = "point", orientation = "y", color = "red") + ylab("") + xlab("Otosten histogrammit") + theme(legend.position = "none", axis.text.y = element_blank(), text = element_text(size = 8))
  
means2 = data.frame("means" = unique(ridgelines2$mean))

meanplot2 = ggplot(means2, aes(x = means)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(58, 62, by = 0.25), 
                   colour = "black", 
                   fill = "grey") +
  xlim(55,65) +
  stat_function(fun = dnorm, args = list(mean = mean(means2$means), sd = sd(means2$means)), 
                aes(colour = "line1")) +
   stat_function(fun = dnorm, args = list(mean = 60, sd = sqrt(0.25)), 
                aes(colour = "line2")) +
 theme_bw() + labs(x = "Otoskeskiarvot", y = "", color = "Tiheysfunktio") + 
  scale_colour_manual(values = c("line1" = "red", "line2" = "blue"), 
                      labels = c("Estimaatit: N(60.1, 0.2)", "Teoreettinen: N(60,0.3)")) + 
  theme(legend.position="bottom", strip.background = element_rect(colour="white", fill=NA), text = element_text(size = 8))

ggpubr::ggarrange(singlesamples2, meanplot2, ncol = 2, nrow = 1, labels = c("Paneeli A", "Paneeli B"))
```

  
__Standardoidun aritmeettisen keskiarvon otosjakauma__

- Tarkastellaan __standardoitua__ satunnaismuuttujaa
$$
Z = \frac{\bar{Y} - \text{E}(\bar{Y})}{\text{D}(\bar{Y})} = \frac{\bar{Y} - \mu}{\sigma / \sqrt{n}} = \sqrt{n} \Big(\frac{\bar{Y} - \mu}{\sigma}\Big).
$$
  - Tällöin $Z$:n odotusarvo $\text{E}(Z) = 0$ ja varianssi $\mathrm{Var}(Z) = 1$.

- Jos $Y_i \thicksim \text{N}(\mu, \sigma^2), i=1,\ldots,n$, niin tällöin $Z$ noudattaa standardoitua normaalijakaumaa: 
$$
Z \thicksim \text{N}(0,1).
$$
  - Jälleen voidaan osoittaa, että tämä tulos pätee asymptoottisesti (suurissa otoksissa) myös ilman yllä tehtyä normaalisuusoletusta.
  
## Suhteellisen frekvenssin otosjakauma {#alaluku92}

__Frekvenssi ja suhteellinen frekvenssi__

- Oletetaan, että tapahtuman $A$ todennäköisyys on
$$
\text{P}(A) = p,
$$
jolloin tapahtuman $A$ komplementtitapahtuman (vastatapahtuman) $A^c$ todennäköisyys on
$$
\text{P}(A^c) = 1- p = q.
$$

- Poimitaan satunnaisotos, jonka koko on $n$. Tällöin $A$-tyyppisten alkioiden frekvenssi eli lukumäärä kyseisessä otoksessa on $f$. 

- Suhteellinen frekvenssi eli osuus on tällöin
$$
\widehat{p} = \frac{f}{n}.
$$
- Sekä frekvenssi (lukumäärä) $f$ ja (täten myös) suhteellinen frekvenssi $\widehat{p}$ ovat satunnaismuuttujia, joiden saamat arvot vaihtelevat satunnaisesti otoksesta toiseen.
  
__Frekvenssin otosjakauma__

- Frekvenssillä $f$ on odotusarvo
$$
\text{E}(f) = np,
$$
ja varianssi
$$
\mathrm{Var}(f) = npq = np(1-p).
$$
- Frekvenssi $f$ noudattaa binomijakaumaa parametrein $n$ ja $p$:
$$
f \thicksim \mathrm{Bin}(n,p).
$$

__Suhteellinen frekvenssi: Odotusarvo ja varianssi__

- Suhteellisen frekvenssin $\widehat{p}$ odotusarvo
$$
\text{E}(\widehat{p}) = \text{E} \Big(\frac{f}{n} \Big) = p,
$$
ja varianssi
$$
\mathrm{Var}(\widehat{p}) = \frac{pq}{n} = \frac{p(1-p)}{n}.
$$

- Suhteellisen frekvenssin $\widehat{p}$ standardipoikkeamaa
$$
\text{D}(\widehat{p}) = \sqrt{\mathrm{Var} (\widehat{p})} =  \sqrt{\frac{pq}{n}}
$$
voidaan kutsua __suhteellisen frekvenssin keskivirheeksi__ ja se kuvaa suhteellisen frekvenssin otosvaihtelua odotusarvon $p$ ympärillä.

__Suhteellisen frekvenssin otosjakauma__

- Koska $\text{E}(\widehat{p}) = p$ ja $\mathrm{Var}(\widehat{p}) = \frac{pq}{n}$, 
niin suhteellisen frekvenssin otosjakauma keskittyy yhä voimakkaammin tapahtuman A
todennäköisyyden $\text{P}(A) = p$ ympärille, kun otoskoko $n$ kasvaa.

- Jälleen suurten otosten tapauksessa voidaan osoittaa, että suhteellinen frekvenssi noudattaa em. oletusten pätiessä normaalijakaumaa:
$$
\widehat{p} \thicksim \text{N} \Big(p, \frac{pq}{n} \Big).
$$

- Aritmeettisen keskiarvon tapaan standardoitu sm. 
$$
Z = \frac{\widehat{p} - p}{\sqrt{\frac{pq}{n}}} \thicksim \text{N}(0,1)
$$
noudattaa suurissa otoksissa approksimatiivisesti standardoitua normaalijakaumaa.

\newpage

::: {.eblock .kimmo data-latex="{}"}
**EU-kansanäänestys**  


- Suomen EU-kansanäänestyksessä vuonna 1994 jäsenyyttä kannattaneiden suhteellinen osuus oli 0,54 (54 \%).

- Mikä olisi ollut tällöin tn., että juuri ennen äänestystä 200 havainnon otoksessa kyllä-osuus olisi ollut alle 50 \%?

- Suhteellisen frekvenssin otosjakauman perusteella kyllä-kannatusosuuden jakauma olisi
$$
%\widehat{p} \stackrel{as}{\thicksim} \text{N} \Big(0.54, \frac{0.54 \times (1-0.54)}{200} \Big),
\widehat{p} \thicksim \text{N} \Big(0.54, \frac{0.54 \times (1-0.54)}{200} \Big),
$$
jossa $\frac{0.54 \times (1-0.54)}{200} = 0.0352^2$.

- Näin ollen haluttu todennäköisyys (ts. saada sellainen satunnaismuuttujan $Z \thicksim \text{N}(0,1)$ arvo että suhteellinen osuus on pienempi kuin 0.5)
$$
P \Big(Z < \frac{0.5-0.54}{0.0352} \Big) = P (Z < -1.14) \approx 0.127.
$$
:::

\FloatBarrier
```{r normaalilv1, echo=FALSE, fig.cap="Standardinormaalijakauman tiheysfunktion alle jäävä siniseksi värjätty osuus kuvaa todennäköisyyttä, jolla saadaan sellainen realisaatio että suhteellinen osuus on pienempi kuin 0.5 yllä olevassa esimerkissä", fig.align='center', out.width="100%", warning=FALSE}
ggplot(NULL, aes(c(-4,4))) +
  geom_area(stat = "function", fun = dnorm,
            aes(color = "line1", 
                fill  = "line1"), fill = NA) +
  geom_area(stat = "function", fun = dnorm, xlim = c(-4, -1.14),
            aes(color = "line2",
                fill  = "Häntätodennäköisyys")) +
  labs(x = "", y = "") +
  scale_colour_manual(" ", values = c("line1" = "red", 
                                      "line2" = "red"), labels = NULL, guide = "none") +
  scale_fill_manual(" ", values   = c("line1" = "red", 
                                      "Häntätodennäköisyys" = "skyblue")) +
  theme(legend.position="bottom") 
```
\FloatBarrier

## Luottamusvälit {#alaluku93}

- Satunnaisesti saadusta aineistosta laskettujen tunnuslukujen luotettavuus on tilastollisen mallin parametrien estimoinnissa keskeinen tilastollinen kysymys. 
  - Otoksen poimintaan liittyvän satunnaisvaihtelun vuoksi emme voi varmuudella tietää onko saatu otokseen perustuva parametriestimaatti "lähellä" vai "kaukana" sen todellista arvoa.
  - Täten tarvitaan jokin tapa, jolla saadun parametriestimaatin luotettavuutta voidaan arvioida.

::: {.defblock .mikko data-latex="{}"}
**Luottamusväli**  

Luottamusväli on otoksen perusteella määrätty väli, joka tutkijan valitsemalla todennäköisyydellä (luottamustasolla) peittää tarkasteltavan tilastollisen mallin $f(y;\theta)$ parametrin $\theta$ tuntemattoman todellisen arvon. Se perustetaan otostunnusluvun, estimaattorin, otosjakaumaan. 
:::

- Otoskoko on luottamusvälejä koskevissa tarkasteluissa keskeinen ja luottamusväleihin palataankin otoskoon käsittelyn yhteydessä.

- Valittua luottamustasoa merkitään usein $1-\alpha$:lla, jossa __merkitsevyystaso__ (__riskitaso__) $\alpha$ on esimerkiksi $\alpha=0.05$.

- Tulkinta: Jos __otantaa__ jakaumasta $f(y;\theta)$ toistetaan, niin keskimäärin $100 \times (1-\alpha)\%$ otoksista konstruloiduista luottamusväleistä peittää parametrin $\theta$ todellisen arvon.

::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: aritmeettisen keskiarvon otosjakauma normaalijakautuneen aineiston tapauksessa (jatkuu)** 

Mitä edellisen alaluvun esimerkissä tapahtuu kun otosten määrää $J$ kasvatetaan? Teorian perusteella otoskeskiarvojen otosjakauman parametrien pitäisi lähestyä teoreettisia arvojaan. Kuviossa \@ref(fig:otosjakaumat3) havainnollistetaan tätä. Nyt generoitiin $J=1000$ otosta populaatiojakaumasta $N(60,25)$, pitäen otoskokona $n=100$. Paneelissa A on jälleen havainnollistuksen vuoksi esitetty ensimmäisen kahdeksan otoksen histogrammit sekä näiden aritmeettiset keskiarvot (punaiset pisteet). Paneelissa B on kuvattu kaikkien $J=50$ otoksen keskiarvojen histogrammi sekä otoskeskiarvojen teoreettista otosjakaumaa ja vastaavaa estimoitua otosjakaumaa vastaavat tiheysfunktiot. Huomataan, että otosten määrää kasvattamalla otosjakauma lähestyy sen teoreettista jakaumaa! 

Huomioitavaa: useinkaan samasta kohdepopulaatiosta ei ole mahdollista saati järkevää poimia useaa otosta. Edellä havainnollistettu teoreettinen tulos kuitenkin mahdollistaa tilastollisen päättelyn ja parametriestimaattien luottamusvälien konstruloinnin yhteen otokseen perustuen! 
:::

```{r otosjakaumat3, echo=FALSE, fig.cap="Toistetun aineistonkeruun ajatus otosjakaumien taustalla. Vasemmalla on esitetty kahdeksan ensimmäisen otoksen histogrammit samasta jakaumasta, kun otoskoko on 100. Oikealla on yhteensä 1000 otoksesta laskettujen otoskeskiarvojen jakauma.", fig.align='center', out.width="100%", warning=FALSE}
library(ggplot2)
library(ggridges)
set.seed(88)
n = 100
s = 1000
ridgelines2 = data.frame("values" = rnorm(n*s, 60, 5), "sample" = rep(c(1:s), each = n)) %>% group_by(sample) %>% mutate(mean = mean(values))
ridgelines_plot2 = ridgelines2 %>% filter(sample %in% c(1:8))
singlesamples2 = ggplot(ridgelines_plot2, aes(x = values, y = sample, group = sample, fill = sample)) + 
  stat_binline(bins = 15, scale = 1) +
  stat_summary(aes(group = sample), fun = mean, geom = "point", orientation = "y", color = "red") + ylab("") + xlab("Otosten histogrammit") + theme(legend.position = "none", axis.text.y = element_blank(), text = element_text(size = 8))
  
means2 = data.frame("means" = unique(ridgelines2$mean))

meanplot2 = ggplot(means2, aes(x = means)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(58, 62, by = 0.25), 
                   colour = "black", 
                   fill = "grey") +
  xlim(55,65) +
  stat_function(fun = dnorm, args = list(mean = mean(means2$means), sd = sd(means2$means)), 
                aes(colour = "line1")) +
   stat_function(fun = dnorm, args = list(mean = 60, sd = sqrt(0.25)), 
                aes(colour = "line2")) +
 theme_bw() + labs(x = "Otoskeskiarvot", y = "", color = "Tiheysfunktio") + 
  scale_colour_manual(values = c("line1" = "red", "line2" = "blue"), 
                      labels = c("Estimaatit: N(60, 0.26)", "Teoreettinen: N(60,0.25)")) + 
  theme(legend.position="bottom", strip.background = element_rect(colour="white", fill=NA), text = element_text(size = 8))

ggpubr::ggarrange(singlesamples2, meanplot2, ncol = 2, nrow = 1, labels = c("Paneeli A", "Paneeli B"))
```

- Oletetaan, että olemme tehneet johtopäätöksen, että konstruloitu luottamusväli peittää parametrin $\theta$ tuntemattoman todellisen arvon. 
  - Tällöin otantaa toistettaessa luottamusvälin konstruktiosta seuraa, että tehty johtopäätös on oikea keskimäärin $100 \times (1-\alpha)\%$ tapauksista.
  - Vastaavasti taas $100 \times \alpha \%$ ei peitä parametrin todellista arvoa.

- Luottamusväli on kenties tunnetumpi kansankieliseltä nimitykseltään __virhemarginaali__, joka on itse asiassa luottamusvälin puolikas: todellinen parametriarvo kuuluu saadun estimaatin ja virhemarginaalien sisään jäävälle osuudelle.
  - Normaalisti mm. otoskoon kasvu pienentää virhemarginaalia.
  - Kuten jatkossa tullaan havaitsemaan, virhemarginaalin suuruuteen vaikuttavat otosasetelma, otoskoko, luottamustaso ja tutkittavan tilastollisen tunnusluvun jakauma.

- Luottamusväleissä ei varsinaisesti ole kyse "virheestä" vaan saadun/muodostetun tiedon tarkkuudesta.
  - Luottamusvälit, eli virhemarginaalit, siis (yleisesti) riippuvat valittavasta luottamustasosta $1-\alpha$ ja näin ollen samasta aineistosta on saatavissa useita virhemarginaaleja.
    - Täten on tarkalleen ottaen virheellistä sanoa, että "tutkimuksen virhemarginaali on 3,5 puoleen tai toiseen".
    - Oikeammin olisi sanoa esimerkiksi "tutkimuksessa saadun kannatuksen virhemarginaali on 3,5 puoleen tai toiseen 95 \% luottamustasolla."
    - Virhemarginaali kasvaa, kun aineistoa lohkotaan: jos tuhannen hengen otoksesta esitetään tietoja, jotka kuvaavat erikseen miesten ja naisten ominaisuuksia, sukupuolittain lasketut ovat estimaatit epävarmempia kuin koko otoksesta esitetyt.
  - Vastaavasti on virheellistä sanoa että tutkimuksella olisi virhemarginaali, sillä virhemarginaali liittyy aina vain tutkimuksen antamiin numeerisiin arvoihin. 
  - Aitoja virhelähteitä ovat mm. otantatutkimukseen liittyvien kysymysten muotoilu, käsitteiden monitulkintaisuus, vastaajien valikoituminen ja vastauskato.

__Normaalijakauman odotusarvon luottamusväli__

- Käsittelemme seuraavassa (normaalijakauman) odotusarvon $\mu$ luottamusvälejä ja jatkossa oletetaan (ellei toisin mainita), että taustalla oleva populaatio, $N$, on "iso" (ääretön). 
  - Näin ollen ns. äärellisyyskorjausta ei käytetä (yksinkertaisuuden vuoksi).

- Tarkastellaan satunnaisotosta normaalijakaumasta 
$Y_1, \ldots, Y_n \indep, \,\, Y_i \thicksim \text{N}(\mu, \sigma^2),\, i=1,\ldots,n$.

- Tarkastellaan normaalijakauman odotusarvon $\mu$ luottamusvälin määräämistä otannan avulla olettaen että jakauman varianssi $\sigma^2$ on tunnettu.
  - Muistetaan että normaalijakauman odotusarvoparametrin $\text{E}(Y_i) = \mu$ __harhaton estimaattori__ on aritmeettinen keskiarvo

$$
\bar{Y} = \frac{1}{n} \sum_{i=1}^{n} Y_i.
$$


- Valitaan __luottamustasoksi__ $1-\alpha$, eli $\alpha$ määrää todennäköisyyden, jolla luottamusväli peittää odotusarvon $\mu$ todellisen arvon: yleinen valinta ihmistieteissä on $\alpha = 0.05$ tai $\alpha = 0.1$ vastaten 95% ja 90% prosentin luottamustasoa. Luonnontieteissä $\alpha$ on usein paljon pienempi. 

- Määrätään __luottamuskertoimet__ $-z_{\alpha/2}$ ja $z_{\alpha/2}$ (luottamusväli on kaksisuuntainen), joille pätee
$$
\text{P}(-z_{\alpha/2} \le Z \le z_{\alpha/2}) = 1-\alpha,
$$
jossa standardoitu satunnaismuuttuja
$$
Z = \frac{\bar{Y} - \mu}{\sigma / \sqrt{n}} = \sqrt{n} \Big( \frac{\bar{Y} - \mu}{\sigma} \Big),  
$$
(ks. aiemmat alaluvut tässä luvussa \@ref(luku9)) noudattaa $\text{N}(0,1)$-jakaumaa. 
  - $\text{P}(\cdot)$:llä merkitään todennäköisyyttä, joka tässä tapauksessa liittyy normaalijakaumaan, ja $z_{\alpha/2}$ on jakaumafunktion arvo pisteessä $\alpha/2$.

- Tällöin etsitään odotusarvoparametrille $\mu$ sellainen arvo, jolla oheinen epäyhtälö pätee ja päädytään luottamusväliin.

- Nyt epäyhtälöketju voidaan kirjoittaa muodossa
$$
-z_{\alpha/2} \le  \frac{\bar{Y} - \mu}{\sigma / \sqrt{n}}  \le z_{\alpha/2}.
$$

- Joka voidaan kirjoittaa uudelleen muodossa
$$
\bar{Y} - z_{\alpha/2} \frac{\sigma}{\sqrt{n}} \le   \mu  \le 
\bar{Y} + z_{\alpha/2} \frac{\sigma}{\sqrt{n}},
$$
kertomalla nimittäjällä puolittain ja vähentämällä sm:jien keskiarvo molemmin puolin. 

- Normaalijakauman odotusarvon $(1-\alpha) \times 100$% luottamusväli on siis
$$
\Big(\bar{Y} - z_{\alpha/2} \frac{\sigma}{\sqrt{n}}, 
\bar{Y} + z_{\alpha/2} \frac{\sigma}{\sqrt{n}} \Big).
$$

- Luottamusväli on symmetrinen keskipisteensä $\bar{Y}$ suhteen. Siksi luottamusväli esitetään usein
$$
\bar{Y} \pm z_{\alpha/2} \frac{\sigma}{\sqrt{n}}.
$$

- Luottamusvälin pituus
$$
2 \cdot z_{\alpha/2} \frac{\sigma}{\sqrt{n}}.
$$

- __Virhemarginaali__ on luottamusvälin pituuden puolikas eli 
$$
z_{\alpha/2} \frac{\sigma}{\sqrt{n}}.
$$

- Edellä tiettyyn otokseen liittyvä luottamusväli perustetaan realisoituneeseen otoskeskiarvoon $\bar{y}=\frac{1}{n} \sum_{i=1}^{n} y_i$.

- Olisi toivottavaa pystyä konstruoimaan parametrille $\mu$ mahdollisimman lyhyt luottamusväli, johon liittyvä luottamustaso olisi samanaikaisesti mahdollisimman korkea. Molempien vaatimusten samanaikainen täyttäminen ei ole kuitenkaan mahdollista, jos otoskoko $n$ pidetään kiinteänä:
  - Luottamustason kasvattaminen pidentää luottamusväliä, jolloin tieto parametrin $\mu$ todellisesta arvosta tulee epätarkemmaksi.
  - Luottamusvälin lyhentäminen pienentää luottamustasoa, jolloin tieto parametrin $\mu$ todellisesta arvosta tulee epävarmemmaksi.

```{r foo, echo=FALSE, fig.cap="Standardoitu normaalijakauma: Virhemarginaaleja", fig.align='center', out.width = "150%"}
knitr::include_graphics("images/gaussian-distribution.jpg")
```

\

__Normaalijakauman odotusarvon luottamusväli ($\sigma^2$ tuntematon)__

- Tarkastellaan edelleen satunnaisotosta normaalijakaumasta, mutta oletetaan nyt että varianssi $\sigma^2$ tuntematon.

- Normaalijakauman odotusarvon $(1-\alpha) \times 100$\% luottamusväli:
$$
\Big(\bar{Y} - t_{\alpha/2} \frac{S}{\sqrt{n}}, 
\bar{Y} + t_{\alpha/2} \frac{S}{\sqrt{n}} \Big),
$$
jossa __luottamuskertoimet__ $-t_{\alpha/2}$ ja $t_{\alpha/2}$
saadaan nyt $t$__-jakaumasta__ $t_{n-1}$, jossa $S^2$ on varianssin $\sigma^2$ harhaton estimaattori ja vapausasteiden lukumäärä on $n-1$.

  - (Studentin) $t$-jakauma muistuttaa silmämääräisesti normaalijakaumaa, mutta se on paksuhäntäisempi. Vapausasteluvun kasvaesssa $t$-jakauma lähestyy normaalijakaumaa.

  - Suurissa otoksissa ($n$ iso) luottamuskertoimet voidaan poimia (approksimatiivisesti) myös normaalijakaumasta eli korvata edellä kertoimet $t_{\alpha/2}$ aiemmin käytetyillä kertoimilla $z_{\alpha/2}$.

  - Normaalijakauman odotusarvon luottamusväli ($\sigma^2$ tuntematon), $t$-jakauma eri vapausastein $df$

```{r, echo=FALSE, fig.cap="t-jakauman (ja standardoidun normaalijakauman) tiheysfunktioita", fig.align='center', out.width = "75%"}
knitr::include_graphics("images/NjaT-jakauma.jpg")
```

\

__Luottamusväli: Suhteellisen osuuden odotusarvo__

- Käsittelemme seuraavassa suhteellisen osuuden $p$ luottamusvälejä.

- Tarkastellaan satunnaisotosta Bernoulli-jakaumasta 
$Y_1, \ldots, Y_n \indep, \,\, Y_i \thicksim B(p),\, i=1,\ldots,n$,
jossa merkitään $Y_i=1$ jos tapahtuma A tapahtuu ja $Y_i=0$ jos tapahtuma A ei tapahdu.

- Bernoulli-jakauman odotusarvoparametrin $p=\text{E}(Y_i)$ harhaton estimaattori on tapahtuman A suhteellinen otosfrekvenssi
$$
\widehat{p} = \frac{1}{n} \sum_{i=1}^{n} Y_i.
$$

- Bernoulli-jakauman (vrt. binomijakauma) ominaisuuksien 
perusteella $\text{E}(Y_i)=p$ ja $\mathrm{Var}(Y_i)=pq$, jossa
$q=1-p$.

- Näin ollen voimme normaalijakauman odotusarvoparametrin
luottamusvälin konstruloinnin tapaan määritellä satunnaismuuttujan $Z$:
$$
Z = \frac{\widehat{p} - p}{\sqrt{\frac{p (1-p)}{n}}} = 
\sqrt{n} \Big(\frac{\widehat{p} - p}{\sqrt{p (1-p)}} \Big),  
$$
joka noudattaa (suurissa otoksissa) $\text{N}(0,1)$-jakaumaa.

- Suhteellisen frekvenssin hajonnan estimaattori on siis
$$
\sqrt{\frac{\widehat{p} (1-\widehat{p})}{n}},
$$
jossa tuntematon $p$ on korvattu sen estimaattorilla (otosvastineella) $\widehat{p}$.


- Luottamuskertoimet määrätään aiempaan tapaan:
$$
\text{P}(-z_{\alpha/2} \le Z \le z_{\alpha/2}) = 1-\alpha.
$$


- Näin ollen odotusarvoparametrin (suhteellisen osuuden) $p$ $(1-\alpha)$% luottamusväliksi
saadaan
$$
\Big(
\widehat{p} - z_{\alpha/2} \sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}},
\widehat{p} + z_{\alpha/2} \sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}} 
\Big)
$$

- Luottamusväli voidaan kirjoittaa
$$
\widehat{p} \pm z_{\alpha/2} \sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}}
$$
ja luottamusvälin pituus on 
$$
2 \times z_{\alpha/2} \sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}}.
$$

## Otoskoko {#alaluku94}

- Yksi tilastollisen päättelyn keskeisiä tavoitteita on yleistää otoksen pohjalta tehty päättely koskemaan koko perusjoukkoa. Seuraavaksi käymme läpi seikkoja, jotka tulee ottaa huomioon otoskokoa miettiessä.
- Kun on päätetty, millainen tutkimusaineisto halutaan kerätä, on päätettävä, kuinka suuri otoksen on oltava, jotta se edustaa tutkittavaa joukkoa kattavasti.
  - Liian pieni __otoskoko__, eli pieni määrä otokseen poimittuja tilastoyksiköitä, voi __sattumalta__ poiketa paljonkin perusjoukosta.
    - Tämä niin kutsuttu __otantavirhe__ on sitä suurempi mitä pienempää otosta käytetään.
    - Liian pienen otoksen vuoksi muuten hyvin toteuttu tutkimus- ja otanta-asetelma saattaa epäonnistua vastaamaan tutkimuksen mielenkiinnon kohteena olevaan kysymykseen.
  - Todella suuren otoksen koostaminen voi olla __työlästä__, __kallista__ tai joskus jopa **täysin mahdotonta** esimerkiksi siksi että käytettävissä olevat tutkimusyksiköt eivät ole käytettävissä ajallisten rajoitteiden vuoksi (kuten harvinaisten tautien kantajat). 
    - Toisaalta perusjoukon systemaattiset piirteet tulevat otoskoon kasvaessa paremmin esille, vaikka yksittäisten otosyksiköiden tilastolliset muuttujat saattavat vaihdella suuresti.
  - __Otoskoko__ siis vaikuttaa keskeisesti siihen, miten hyvin otoksesta tehdyt johtopäätökset voidaan yleistää koskemaan koko perusjoukkoa!
- Optimaalinen, tai ainakin tutkimusongelmaan vastaamisen kannalta vähintään riittävä arvio, otoskoosta voidaan usein määrätä etukäteen.

\

__Perusjoukon rooli otoskoon määrittämisessä__

- Ensiksi tulee kuitenkin pohtia käsillä olevaa tutkimusongelmaa esimerkiksi kysymällä: __Millainen on perusjoukkosi?__
  - Onko tutkittavan muuttujan arvoissa paljon vaihtelua? Jos on, niin tämä täytyy huomioida kasvattamalla otoskokoa.
    - Esimerkiksi otosten keskiarvot alkavat käyttäytyä riittävän siististi vasta noin otoskoosta $n=30$ alkaen.
    - Kyseinen otoskoko ei kuitenkaan ole missään tapauksessa yleinen ja pätevä peukalosääntö otoskoon koolle, vaan se tulee aina päättää tutkimusongelmakohtaisesti.
  - Kuuluuko tutkimukseesi esimerkiksi otoksen sisällä olevien ryhmien keskiarvojen vertailua tai muita otoksen osajoukkojen tunnuslukujen vertailua? Jos kuuluu, niin otoskoko tulee valita pienimmän ryhmäkoon mukaan, jotta siitäkin saadaan tarpeeksi edustajia.
    - Mitä isompaa otosta käytetään, sitä pienempi perusjoukossa esiintyvä ryhmien välinen ero pystytään otoksella tunnistamaan. 

__Tulosten vaaditun tarkkuuden vaikutus otoskokoon__

- Tarkastelemme pian esimerkin avulla, kuinka tarvittavaa otoskokoa voidaan approksimoida tulosten halutun tarkkuuden avulla. 
- Tarkastellaan kuitenkin ensin minkälaiset kysymykset liittyvät otoskoon pohdintaan tulosten tarkkuuden osalta. 
  - Kuinka varma sinun on oltava, että tulokset ovat luotettavia? Tämä on virhemarginaalisi. 
    - Esimerkiksi puoluekannatuksen arvioimiseen 2 \% virhemarginaalilla riittää huomattavasti pienempi otoskoko kuin 0.2 \% virhemarginaalilla. Politiikan tutkija voisikin kasvattaa otoskokoa vaalien lähestyessä, mikäli mielii saada tarkempia tuloksia.
  - Kuinka varma haluat olla, että otos edustaa joukkoa oikein? Tämä on luottamustaso. 
    - Luottamustaso on todennäköisyys sille, että valitsemasi otos on tulosten kannalta oleellinen.
    - Jos joukosta poimitaan 30 otosta sattumanvaraisesti, kuinka usein yhdestä otoksesta saadut tulokset eroavat merkittävästi muista 30 otoksesta? Jos luottamustaso on 95 \%, samat johtopäätelmät saadaan 95 prosentissa tapauksista. 

__Odotetun vastauskadon vaikutus otoskokoon__

- Kuinka suuri vastauskato tulee mahdollisesti olemaan?
  - Yleensä osa kyselytutkimukseen valituista jättää vastaamatta. Tätä kutsutaan kadoksi. Kato vinouttaa otosta, jos vastaamatta jättäneet ovat mielipiteiltään erilaisia kuin vastanneet.
  - Otoskoon kasvattaminen ei paranna kadon aiheuttamaa vinoutumista.
- Esimerkki: Jos Alkon myymälän asiakastutkimus suoritetaan ovensuukyselynä maanantaina aamupäivällä, niin vastaajat eivät luultavasti edusta myymälän koko asiakaskuntaa. Otantakehikko on tässä liian suppea ja seurauksena on todennäköisesti vinoutunut otos. Vinoutuma ei korjaannu vaikka otosta kasvatetaan maanantai-aamupäivän asiakkailla.

\

::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: otoskoko normaalijakauman odotusarvon estimoinnissa**  


- Palautetaan mieleen normaalijakauman $\text{N}(\mu,\sigma^2)$ odotusarvon luottamusvälin määrääminen (kun varianssi $\sigma^2$ oletetaan tunnetuksi).

- Luottamusväliksi saatiin
$$
\bar{Y} \pm z_{\alpha/2} \frac{\sigma}{\sqrt{n}},
$$
ja luottamusvälin symmetrisyydestä johtuen luottamusvälin pituus
$$
2 \times z_{\alpha/2} \frac{\sigma}{\sqrt{n}}.
$$

- Oletetaan, että normaalijakauman odotusarvoparametrille $\mu$ halutaan konstruoida luottamusväli, jonka toivottu pituus on $2d$ (huom. symmetrisyys).

- Luottamusvälin lausekkeesta saadaan täten järjestelemällä
$$
n = \Big(\frac{z_{\alpha/2} \, \sigma}{d} \Big)^2.
$$

- Jos varianssi $\sigma^2$ on tuntematon, se voidaan kaavassa korvata havaitulla otosvarianssilla $s^2$, jolloin
$$
n = \Big(\frac{z_{\alpha/2} \, s}{d} \Big)^2.
$$
- Pitäydytään (yksinkertaisuuden vuoksi) luottamuskertoimissa $z_{\alpha/2}$ vaikka varianssi $\sigma^2$ olisikin tuntematon. 
:::



::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: otoskoko**

- Oletetaan, että haluamme määrätä otoskoon niin, että otoskeskiarvo poikkeaa populaatiokeskiarvosta korkeintaan yhden yksikön ($d = 1$) todennäköisyydellä $0.05$. Oletetaan, että varianssi on aiemmissa tutkimuksissa ollut $\sigma^2 = 5$. Oletetaan lisäksi, että taustallaoleva perusjoukko on iso (ääretön).

- Tällöin otoskoon tulisi olla
$$
n \ge \Big(\frac{z_{\alpha/2} \, \sigma}{d} \Big)^2 = \Big(1.96 \sqrt{5} \Big)^2 \approx 19.2.
$$

- Tarvittavan otoskoon tulisi siis olla tässä tapauksessa noin 20.
:::


__Äärellisyyskorjaus__:

- Äärellisyyskorjausta käytetään, jos otos poimitaan äärellisestä perusjoukosta palauttamatta ja (nyrkkisääntönä)
$$
\frac{n}{N} > 0.05,
$$
jossa $n$ on edelleen otoskoko, $N$ perusjoukon koko ja $n < N$.

- Jos suhde $n/N$ on lähellä arvoa 1, tarkoittaa se, että perusjoukosta
huomattava osa kuuluu otokseen. 
  - Tällöin otoskeskiarvon poikkeama populaatiokeskiarvosta on luonnollisesti pienempi kuin pienemmän otoksen tilanteessa. 
  - Otoskoon kasvattaminen lisää siis estimoinnin tarkkuutta, ja juuri äärellisyyskertoimen avulla hajonta "korjataan" vastaamaan käytettyä otoskokoa.



__Otoskoko, äärellisyyskorjaus: Normaalijakauman odotusarvon estimointi__


- Oletetaan, että otannan taustalla oleva perusjoukko on äärellinen (pieni).

- Tällöin luottamusvälin konstruloinnissa huomioidaan äärellisyyskorjaus
(vrt. aiemmat kaavat):
$$
\bar{Y} \pm z_{\alpha/2} \sqrt{\Big(\frac{N-n}{N}\Big)\frac{\sigma^2}{n}}.
$$

- Tarvittava otoskoko on tällöin välivaiheiden jälkeen
$$
n =\frac{1}{\frac{d^2}{z^2_{\alpha/2} \sigma^2} + \frac{1}{N}}.
$$

\


::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: otoskoko (jatkoa)**

- Oletetaan aiemman esimerkin tilanne kuitenkin siten, että perusjoukon koko on nyt $N=100$.

- Tällöin otoskooon tulisi olla
$$
n  \ge \frac{1}{\frac{1}{1.96^2 \times 5} + \frac{1}{100}} \approx 16.11.
$$
- Tarvittava otoskoko on siis noin 17.
:::

\

__Otoskoko: Suhteellinen osuus__

- Palautetaan mieleen Bernoulli-jakauman odotusarvoparametrin $p$ luottamusvälin muodostaminen.
  - Kuten normaalijakauman odotusarvoparametrin tapauksessa, pyrimme muodostamaan mahdollisimman lyhyen luottamusvälin, johon liittyvä luottamustaso olisi samanaikaisesti mahdollisimman korkea.
- Oletetaan aiempaan tapaan, että $p$:lle halutaan muodostaa luottamusväli, jonka toivottu pituus on $2d$.
- Tarvittava otoskoko saadaan kaavasta (kun perusjoukko oletetaan äärettömäksi)

$$
n = \Big(\frac{z_{\alpha/2} \,\, \sqrt{p(1-p)}}{d} \Big)^2.
$$


\
\

__Suhteellinen osuus, äärellisyyskorjaus:__

- Tarvittava otoskoko saadaan  äärellisyyskorjausta käytettäessä kaavasta
$$
n = \frac{N p (1-p)}{\frac{(N-1) d^2}{z^2_{\alpha/2}} + p(1-p)}.
$$
  - Voidaan osoittaa, että jos perusjoukko $N$ on iso (ääretön), niin tällöin edellinen lauseke supistuu aiempaan otoskokoa osoittavaan lausekkeeseen.
- Usein otoskokoa määrättäessä suhteellisesta osuudesta ei ole olemassa arviota.
- Tällöin suhteellisen osuuden $p$ arvoksi asetetaan useimmiten $p=0.5$, jolloin suhteellisen osuuden varianssi on suurin.

\newpage

::: {.eblock .kimmo data-latex="{}"}
**Esimerkki: Otoskoko ja suhteellinen osuus**

- Geologi haluaa arvioida kallion kultapitoisuuden ottamalla kivinäytteen $n$ eri pisteestä. Jokaisesta näytteestä havaitaan sisältyykö siihen kultaa. Kuinka suuri otos on poimittava, jotta kultapitoisuuden estimointivirheen $d$ arvo on korkeintaan $0.05$ todennäköisyydellä 0.95?

- Tässä kullan suhteellinen osuus on tuntematon, joten $p$:lle asetetaan $p=0.5$.

- Äärellisyyskorjaus voidaan unohtaa, sillä näytteenottopisteiden pinta-alat ovat pieniä (eli niitä on äärettömän paljon, ts. tarkasteltavaan populaatioon niitä sisältyy
hyvin suuri määrä).

- Tällöin otoskoko
$$
n = \frac{1.96^2 \cdot 0.5 \cdot 0.5}{0.05^2} \approx 384.16.
$$
:::



## Luvun 9 yhteenveto, keskeisiä termejä ja kokonaisuuksia.

- Standardipoikkeama
- Standardoitu satunnaismuuttuja
- Standardoidun aritmeettisen keskiarvon otosjakauma
- Suhteellisen frekvenssin otosjakauma
- Luottamusväli
- Virhemarginaali
- Luottamustaso ja luottamuskertoimet
- Normaalijakauman odotusarvon luottamusväli
- Luottamusväli: Suhteellisen osuuden odotusarvo
- Otoskoon määräämisen perusteita
